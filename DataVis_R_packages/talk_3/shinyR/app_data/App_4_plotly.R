#data
dates = c("2014-06-30", "2014-03-31", "2013-12-31", "2013-09-30", "2013-06-30", "2013-03-31", "2012-12-31", "2012-09-30", "2012-06-30", "2012-03-31", "2011-12-31", "2011-09-30", "2011-06-30", "2011-03-31", "2010-12-31", "2010-09-30", "2010-06-30", "2010-03-31", "2009-12-31", "2009-09-30", "2009-06-30", "2009-03-31", "2008-12-31", "2008-09-30", "2008-06-30", "2008-03-31", "2007-12-31", "2007-09-30", "2007-06-30", "2007-03-31", "2006-12-31", "2006-09-30", "2006-06-30", "2006-03-31", "2005-12-31", "2005-09-30", "2005-06-30", "2005-03-31", "2004-12-31", "2004-09-30", "2004-06-30", "2004-03-31", "2003-12-31", "2003-09-30", "2003-06-30", "2003-03-31", "2002-12-31", "2002-09-30", "2002-06-30", "2002-03-31", "2001-12-31", "2001-09-30", "2001-06-30", "2001-03-31", "2000-12-31", "2000-09-30", "2000-06-30", "2000-03-31", "1999-12-31", "1999-09-30", "1999-06-30", "1999-03-31", "1998-12-31", "1998-09-30", "1998-06-30", "1998-03-31", "1997-12-31", "1997-09-30", "1997-06-30", "1997-03-31")
y = c("79.9", "79", "79", "77.9", "77.7", "76.8", "76.8", "74.7", "73.7", "72.3", "72.2", "70.7", "70.1", "68.7", "68.1", "65.7", "64", "62", "58", "53.5", "52.4", "49", "46.3", "41.5", "38.6", "36.7", "37.3", "36.2", "36.5", "36", "36.6", "36.1", "36.4", "35.4", "36.2", "35.1", "35", "34.3", "35", "33.7", "33.5", "31.7", "32.1", "30.9", "30.5", "30.3", "31", "29.4", "29.5", "29.3", "30.3", "29.6", "30.5", "30.1", "31.3", "31.1", "33", "34.6", "36.2", "36.5", "37.7", "37.5", "38.3", "38.9", "39.6", "39.3", "40.5", "41", "41.5", "39.9") 
y2 = c("3.162001663", "2.900595301", "2.679379817", "1.706126601", "1.685817142", "0.843254579", "0.381519576", "0.706778175", "0.570351634", "0.97976592", "1.452541886", "1.492641766", "1.442676561", "2.200529367", "2.172664258", "2.544807736", "2.089689461", "0.838101873", "-1.468346406", "-4.037788009", "-5.823225666", "-5.795513773", "-3.778220468", "-1.123770382", "1.397366633", "2.243856225", "2.702991612", "2.994106464", "2.311863165", "2.20972045", "2.026540323", "2.629150462", "3.504666829", "4.046785712", "4.174174968", "3.205002361", "2.285266499", "1.550127357", "1.160835759", "1.758506376", "2.911949875", "4.044819853", "4.713590793", "4.623536257", "4.22391147", "3.624664263", "3.099155668", "2.486482105", "2.136265885", "2.078727135", "2.768296408", "2.750274373", "2.590458562", "2.547247824", "2.461175713", "3.526836163", "4.819126299", "4.312654091", "3.723979262", "3.396710581", "2.470042359", "3.001127563", "3.165236052", "3.495337573", "3.497633729", "3.896491882", "3.739282365", "2.696593474", "2.318584672", "1.444838694")


my_titlefont <- list(size = 12, family = "\"Open sans\", verdana, arial, sans-serif")
my_titlefont2 <- list(size = 10, family = "\"Open sans\", verdana, arial, sans-serif")
my_annotation_text = list(
  list(
    text = "Rule 1:<br>Debt < 40% GDP,<br>Current balance over cycle", 
    x = 9.15265140628e+11, y = 39.7749169145, 
    ax = -2, ay = -41, 
    xref = "x", yref = "y2",
    font = list(color = "rgb(204, 0, 0)")
  ), 
  list(
    text = "Government re-dates cycle<br>to avoid breaking rule as<br>debt rises despite<br>strong growth", 
    x = 1.11206970771e+12, y = 36.1372270208, 
    ax = -91, ay = -88, 
    xref = "x", yref = "y2"
  ), 
  list(
    text = "Rule 1 broken as<br>debt exceeds 40%", 
    x = 1.21824059258e+12, y = 42.9811846324, 
    ax = -46, ay = -30, 
    xref = "x", yref = "y2"
  ), 
  list(
    text = "Rule 2:<br>Rolling 5yr structural balance,<br>Debt falling by 2015-16", 
    x = 1275346800000, y = 66, 
    ax = -53, ay = -41, 
    xref = "x", yref = "y2",
    font = list(color = "rgb(204, 0, 0)")
  ), 
  list(
    text = "Govt judged likely<br>to breach debt target", 
    x = 1355439600000, y = 74.9845490059, 
    ax = 3, ay = 53, 
    xref = "x", yref = "y2"
  ), 
  list(
    text = "Rule 3:<br>Rolling 3yr structural balance,<br>Debt falling by 2016-17",       
    x = 1418688000000, y = 80, 
    ax = -16, ay = -45, 
    xref = "x", yref = "y2",
    font = list(color = "rgb(204, 0, 0)")
  )
)


library(plotly)
p <- plot_ly(x = dates, y = y, name = "Public sector net debt", yaxis = 'y2',
        line = list(color = "rgb(130, 0, 83)", 
                    dash = "solid", shape = "spline", smoothing = 1)) %>%
add_trace(x = dates, y = y2, name = "RGDP annualgrowth rate", type = 'bar', 
          marker = list(color = "rgb(130, 0, 83)"),
          yaxis = 'y') %>%
layout(title = "Figure 9:UK fiscal rules", 
       xaxis = list(title = "", range = c(851716773740, 1420002026260)),
       yaxis = list(
         title = "Per cent of GDP", 
         titlefont = my_titlefont,
         domain = c(0, 0.25), range = c(-6.5, 5.5)
       ),
       yaxis2 = list(
         title = "Per cent of GDP", 
         titlefont = my_titlefont,
         domain = c(0.35, 1), range = c(25, 95)
       ),
       legend = list(
         x = 0.8, 
         y = 0.4, 
         bgcolor = "rgb(244, 224, 237)", 
         borderwidth = 0, 
         font = my_titlefont2
       ),
       margins = list(r = 75, t = 50, b = 50, l = 50),
       annotations = my_annotation_text
)

